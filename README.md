# –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ä–µ–¥—ã
2. –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
3. –ü–æ–ª—É—á–µ–Ω–∏–µ AST
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è LLVM IR
5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è IR
6. –ì—Ä–∞—Ñ –ø–æ—Ç–æ–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
7. –í—ã–≤–æ–¥—ã
8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π LLVM –∏ –∏—Ö –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∫–æ–¥

---

## 1. –£–°–¢–ê–ù–û–í–ö–ê –ò –ü–û–î–ì–û–¢–û–í–ö–ê –°–†–ï–î–´

–†–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Å—Ä–µ–¥–µ **Ubuntu 22.04**.

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

* `clang` ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —è–∑—ã–∫–∞ C;
* `llvm` ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏;
* `opt` ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∞–±–æ—Ç—ã —Å LLVM IR;
* `graphviz` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤ CFG.

–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
sudo apt update
sudo apt install clang llvm graphviz
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 1**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã `sudo apt install clang llvm graphviz`

---

## 2. –ò–°–•–û–î–ù–´–ô –ö–û–î

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª `main.c` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º:

```c
#include <stdio.h>

int square(int x) {
    return x * x;
}

int main() {
    int a = 5;
    int b = square(a);
    printf("%d\n", b);
    return 0;
}
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 2**: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `main.c`, –æ—Ç–∫—Ä—ã—Ç–æ–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, VS Code –∏–ª–∏ `cat main.c` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)

---

## 3. –ü–û–õ–£–ß–ï–ù–ò–ï AST

–ö–æ–º–∞–Ω–¥–∞:

```bash
clang -Xclang -ast-dump -fsyntax-only main.c
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 3**: –≤—ã–≤–æ–¥ –¥–µ—Ä–µ–≤–∞ AST –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≤—ã–¥–µ—Ä–∂–∫–∞, –º–∏–Ω–∏–º—É–º 10 —Å—Ç—Ä–æ–∫)

–ü–æ—è—Å–Ω–µ–Ω–∏–µ:

* –í–∏–¥–Ω–æ, —á—Ç–æ `FunctionDecl` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `square` –∏ `main`;
* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `a`, `b`, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `x` ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.

---

## 4. –ì–ï–ù–ï–†–ê–¶–ò–Ø LLVM IR

–ö–æ–º–∞–Ω–¥–∞:

```bash
clang -S -emit-llvm main.c -o main.ll
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 4**: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `main.ll`, –æ—Ç–∫—Ä—ã—Ç–æ–µ —á–µ—Ä–µ–∑ `cat main.ll | head -n 20`

–ü–æ—è—Å–Ω–µ–Ω–∏–µ:

* –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `@square` –∏ `@main`;
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `alloca`, `store`, `load`.

---

## 5. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø IR

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è):

```bash
clang -O0 -S -emit-llvm main.c -o main_O0.ll
```

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π:

```bash
clang -O2 -S -emit-llvm main.c -o main_O2.ll
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 5**: `main_O0.ll`, 15 —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ `cat`
üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 6**: `main_O2.ll`, 15 —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ `cat`

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

```bash
diff main_O0.ll main_O2.ll
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 7**: –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `diff`

### –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

* `@square` —É–¥–∞–ª–µ–Ω–∞, —Ç.–∫. –±—ã–ª–∞ –≤—Å—Ç—Ä–æ–µ–Ω–∞ (`-inline`);
* –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å—á–µ–∑–ª–∏ (`mem2reg`, `dce`);
* –û—Å—Ç–∞–ª—Å—è –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `printf` —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π (`constprop`).

---

## 6. –ì–†–ê–§ –ü–û–¢–û–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ì–†–ê–ú–ú–´

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è `.dot`-—Ñ–∞–π–ª–æ–≤:

```bash
opt -dot-cfg -disable-output main_O2.ll
```

–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã: `cfg.main.dot`, –¥—Ä—É–≥–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, —Ç–∞–∫ –∫–∞–∫ `square` —É–¥–∞–ª–µ–Ω–∞.

–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:

```bash
dot -Tpng .main.dot -o cfg_main.png
xdg-open cfg_main.png
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 8**: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `.main.dot` (10 —Å—Ç—Ä–æ–∫)
üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 9**: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ `cfg_main.png`

---

## 7. –í–´–í–û–î–´

* –° –ø–æ–º–æ—â—å—é `clang` –∏ `llvm` –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å AST, IR, CFG.
* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `-O2` —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥:

  * –£–¥–∞–ª—è–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ;
  * –í—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏;
  * –£–±–∏—Ä–∞–µ—Ç –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥;
  * –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∫–æ–¥ –≤ SSA-—Ñ–æ—Ä–º—É.
* –ì—Ä–∞—Ñ –ø–æ—Ç–æ–∫–∞ –ø–æ—Å–ª–µ `-O2` –º–∏–Ω–∏–º–∞–ª–µ–Ω –∏ –ª–∏–Ω–µ–µ–Ω.

---

## 8. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –ó–ê–î–ê–ù–ò–ï: –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï –î–û–ü. –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ô

–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:

```c
#include <stdio.h>

int sum_array(int* arr, int n) {
    int sum = 0;
    for (int i = 0; i < n; ++i)
        sum += arr[i];
    return sum;
}

int main() {
    int data[5] = {1, 2, 3, 4, 5};
    int total = sum_array(data, 5);
    printf("Sum = %d\n", total);
    return 0;
}
```

–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ `sum.c`.

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 10**: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `sum.c`

IR –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

```bash
clang -O0 -S -emit-llvm sum.c -o sum_O0.ll
```

IR —Å –¥–æ–ø. –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏:

```bash
opt -S -loop-unroll -licm -dse sum_O0.ll -o sum_custom.ll
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 11**: `sum_O0.ll` (15 —Å—Ç—Ä–æ–∫)
üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 12**: `sum_custom.ll` (15 —Å—Ç—Ä–æ–∫)

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:

```bash
diff sum_O0.ll sum_custom.ll
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 13**: –≤—ã–≤–æ–¥ `diff`

### –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

* **`-loop-unroll`**: —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Ü–∏–∫–ª, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ;
* **`-licm`**: –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã —Ü–∏–∫–ª–∞ –≤—ã–Ω–µ—Å–µ–Ω—ã;
* **`-dse`**: —É–¥–∞–ª–µ–Ω—ã –ª–∏—à–Ω–∏–µ `store`, –Ω–µ –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è CFG:

```bash
opt -dot-cfg -disable-output sum_custom.ll
dot -Tpng .main.dot -o cfg_sum.png
xdg-open cfg_sum.png
```

üì∏ **–°–∫—Ä–∏–Ω—à–æ—Ç 14**: `cfg_sum.png`

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–º–µ–Ω—è—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É IR –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

  * –¶–∏–∫–ª—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –º–µ–Ω–µ–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏;
  * –£–¥–∞–ª—è—é—Ç—Å—è –Ω–µ–Ω—É–∂–Ω—ã–µ –∑–∞–ø–∏—Å–∏;
  * –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.
* –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª—É—á—à–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
